<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<title>WebSocket_Test</title>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<style>
	html, body {
		width: 100%;
		height: 100%;
		margin: 0;
		padding: 0;

		overflow: hidden;
		background: #111;
		text-align: center;
	}

	#canvas {
		margin: auto;
		margin-top: 30px;

		background: #fff;
	}
	</style>
</head>
<body>
	<canvas id="canvas"></canvas>
	<script>

	var canvasID = document.getElementById("canvas");
	var ctx = canvasID.getContext("2d");
	// canvas サイズ変更
	canvasID.setAttribute("width", "600");
	canvasID.setAttribute("height", "480");

	var mySquare = new Square(0, 0);
	var players = [];

	function Square(x, y) {
		this.x = x;
		this.y = y;
		this.size = 10;

		this.color = "red";
	}

	Square.prototype.draw = function() {
		var halfWidth = this.size / 2;

		ctx.fillStyle = this.color;
		ctx.fillRect(this.x - halfWidth, this.y - halfWidth, this.size, this.size);
	}

	// ループ（fps: 30）
	// setInterval(function() {
	// 	ctx.clearRect(0, 0, 600, 480);
	// 	mySquare.draw();
	// }, 33);

		var socket = io.connect();
	// イベントリスナー
	window.addEventListener("keydown", onKeyDown, false);
	function onKeyDown(e) {
		switch(e.keyCode) {
			case 37:
			mySquare.x += -2;
			break;
			case 38:
			mySquare.y += -2;
			break;
			case 39:
			mySquare.x += 2;
			break;
			case 40:
			mySquare.y += 2;
			break;
		}
		socket.json.emit('data_change', {
			x: mySquare.x,
			y: mySquare.y
		});

		// console.log("keycode : " + e.keyCode);
	}
	socket.on('data_players',function (data) {
		ctx.clearRect(0, 0, 600, 480);
		for(var i = 0 ; i < data.length;i++) {
			var s = new Square(data[i].x,data[i].y);
			s.draw();
		}
	});

	// socket.io 処理
	</script>
</body>
</html>